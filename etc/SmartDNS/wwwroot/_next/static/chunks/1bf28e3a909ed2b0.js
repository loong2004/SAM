(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32528,e=>{"use strict";var t=e.i(54624);e.s(["createSvgIcon",()=>t.default])},78910,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(614),n=e.i(80926),i=e.i(33938),o=e.i(13607),l=e.i(69120),s=e.i(42669),u=e.i(6376),c=e.i(37563),d=e.i(78365),m=e.i(22315),g=e.i(17751),p=e.i(12598),h=e.i(19273),f=e.i(66027),b=e.i(98759),y=e.i(9578);e.i(21845);var S=e.i(22831),C=e.i(73869),v=e.i(76421),_=e.i(57305),w=e.i(83388),z=e.i(36307),x=e.i(50967);function I(){let{t:e}=(0,S.useTranslation)(),r=(0,a.useMemo)(()=>[{accessorKey:"id",header:e("ID"),size:110,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"domain",header:e("Domain"),size:360,enableColumnActions:!1,columnFilterModeOptions:["contains","equals"]},{accessorKey:"domain_type",header:e("Type"),size:90,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"client",header:e("Client"),size:330,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"timestamp",header:e("Time"),Cell:({cell:e})=>{let a=new Date(e.getValue()).toLocaleString();return(0,t.jsx)("span",{children:a})},filterVariant:"datetime-range",columnFilterModeOptions:["equals"],enableColumnActions:!1,size:120},{accessorKey:"ping_time",header:e("Ping"),size:90,enableColumnActions:!1,Cell:({cell:e})=>{let a=e.getValue();return a<0?(0,t.jsx)("span",{children:"N/A"}):(0,t.jsxs)("span",{children:[a," ms"]})},columnFilterModeOptions:["equals"]},{accessorKey:"domain_group",header:e("Group"),columnFilterModeOptions:["equals"],enableColumnActions:!1},{accessorKey:"is_blocked",header:e("Is Blocked"),size:150,columnFilterModeOptions:["equals"],enableColumnActions:!1},{accessorKey:"query_time",header:e("Query Time"),Cell:({cell:e})=>{let a=e.getValue();return(0,t.jsxs)("span",{children:[a," ms"]})},columnFilterModeOptions:["equals"],enableColumnActions:!1},{accessorKey:"reply_code",header:e("Reply Code"),columnFilterModeOptions:["equals"],enableColumnActions:!1}],[e]),{checkSessionError:n}=(0,y.useUser)(),[o,g]=(0,a.useState)([]),[p,I]=(0,a.useState)(()=>Object.fromEntries(r.map(({accessorKey:e})=>[e,"equals"]))),[M,T]=(0,a.useState)(!1),[D,O]=(0,a.useState)(""),[A,j]=(0,a.useState)("Error loading data"),[F,R]=(0,a.useState)([]),q=a.useRef(0),E=a.useRef(null),P="querylog-table-pagination",k=localStorage.getItem(P),N={pageIndex:0,pageSize:10};try{k&&(N=JSON.parse(k))}catch{localStorage.removeItem(P),N={pageIndex:0,pageSize:10}}let[$,K]=(0,a.useState)({pageIndex:0,pageSize:N.pageSize}),[L,B]=(0,a.useState)(0),Q=a.useRef(!1),[V,J]=(0,a.useState)(C.MRT_Localization_EN),{enqueueSnackbar:G}=(0,x.useSnackbar)(),U=!1;window.innerWidth>=1200&&(U=!0),a.useEffect(()=>{let e=new URLSearchParams(location.search),t=[],a=[void 0,void 0],n=!1;for(let[i,o]of e.entries()){if("timestamp_after"===i){let e=(0,m.default)(Number(o));e.isValid()&&(a[0]=e,n=!0);continue}if("timestamp_before"===i){let e=(0,m.default)(Number(o));e.isValid()&&(a[1]=e,n=!0);continue}if("total_count"===i){Q.current=!0,B(Number(o));continue}r.some(e=>e.accessorKey===i)&&t.push({id:i,value:o})}n&&t.push({id:"timestamp",value:a}),g(t),M||T(!0)},[M,r]);let{data:{data:W=[],meta:H}={},isError:Z,isRefetching:X,isLoading:Y,refetch:ee}=(0,f.useQuery)({enabled:M,queryKey:["table-data",p,o,D,$.pageIndex,$.pageSize,F],queryFn:async()=>{let e=$.pageIndex+1,t={page_num:e,page_size:$.pageSize};for(let a of(Q.current&&(Q.current=!1,t.total_count=L),null!==E.current&&void 0!==E.current&&(e>q.current&&e===q.current+1?E.current.lastID>=0&&(t.cursor=E.current.lastID,t.total_count=L,t.cursor_direction="next"):e<q.current&&e===q.current-1&&E.current.firstID>=0&&(t.cursor=E.current.firstID,t.total_count=L,t.cursor_direction="prev")),q.current=e,o)){if(null===a.id||void 0===a.id||null===a.value||void 0===a.value)continue;let e=p[a.id];if("domain"===a.id&&"contains"===e&&(t.domain_filter_mode=e),"timestamp"===a.id){let e=a.value;2===e.length&&(e[0]&&(t.timestamp_after=new Date(e[0]).getTime()),e[1]&&(t.timestamp_before=new Date(e[1]).getTime()))}t[a.id]=a.value}let a=await b.smartdnsServer.GetQueryLogs(t);if(a.error)throw await n?.(a.error),j(b.smartdnsServer.getErrorMessage(a.error)),Error(A);if(null===a.data||void 0===a.data)throw j("Error loading data"),Error(A);let r=0;return a.data.total_count>0&&a.data.domain_list.length>0&&(E.current={firstID:a.data.domain_list[0].id,lastID:a.data.domain_list.at(-1).id,pageNumber:e+1},r=a.data.total_count),B(r),{data:a.data.domain_list,meta:{totalRowCount:r}}},placeholderData:h.keepPreviousData});a.useEffect(()=>{null!==_.default.language&&void 0!==_.default.language&&("zh-CN"===_.default.language?J(v.MRT_Localization_ZH_HANS):J(C.MRT_Localization_EN))},[]);let et=a.useCallback(async t=>{let a=t.original.domain,r=await b.smartdnsServer.GetWhois(a);if(r.error)return void G(`Error: ${e(b.smartdnsServer.getErrorMessage(r.error))}`);if(null===r.data||void 0===r.data)return void G(`Error: ${e("No data returned.")}`);let n=r.data,i="",o="";n.domain.length>0&&(o+=`${e("Domain")}: ${n.domain}
`),n.organization.length>0&&(i+=`${e("Organization")}: ${n.organization}
`),n.registrar.length>0&&(i+=`${e("Registrar")}: ${n.registrar}
`),n.country.length>0&&(i+=`${e("Country")}: ${n.country}
`),0===i.length&&(i=e("Whois data not available")),G(o+i,{style:{whiteSpace:"pre-line"}})},[e,G]),ea=a.useCallback(async t=>{let a=t.original.id,r=t.original.domain,n=await b.smartdnsServer.DeleteQueryLogById(a);n.error?G(`${e("Error")}: ${e(b.smartdnsServer.getErrorMessage(n.error))}, id: ${a}`,{variant:"error"}):G(e("Delete query log {{id}} {{domain}} successfully.",{id:a,domain:r}),{variant:"success"})},[e,G]),er=(e,a,r)=>[(0,t.jsx)(i.MRT_ActionMenuItem,{icon:(0,t.jsx)(z.default,{}),label:"whois",onClick:async t=>{t.preventDefault(),e(),await et(a)},table:r},"whois"),(0,t.jsx)(i.MRT_ActionMenuItem,{icon:(0,t.jsx)(w.default,{}),label:"Delete",onClick:async t=>{t.preventDefault(),e(),await ea(a)},table:r},"delete")],{colorScheme:en}=(0,c.useColorScheme)(),ei=a.useMemo(()=>(0,u.createTheme)({palette:{mode:"dark"===en?"dark":"light"}}),[en]).palette.background.paper,eo="querylog-table-column-visibility",el="querylog-table-column-sizing",es=localStorage.getItem(eo),eu=localStorage.getItem(el),ec={},ed={};try{es&&(ec=JSON.parse(es))}catch{localStorage.removeItem(eo),ec={}}try{eu&&(ed=JSON.parse(eu))}catch{localStorage.removeItem(el),ed={}}let em=ec||{id:!1,is_blocked:!1,domain_group:!1,query_time:!1,reply_code:!1},[eg,ep]=a.useState(em),[eh,ef]=a.useState(ed),eb=(0,i.useMaterialReactTable)({columns:r,data:W,localization:V,enableColumnResizing:!0,enableSorting:!1,enableColumnOrdering:!0,enableRowActions:!0,enableCellActions:!0,enableClickToCopy:window.isSecureContext,enableGlobalFilter:!1,columnFilterDisplayMode:"popover",enableColumnFilterModes:!0,enableColumnPinning:!0,enableColumnDragging:!1,enableKeyboardShortcuts:!1,manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiFilterDateTimePickerProps:{ampm:!1},muiPaginationProps:{disabled:X},muiToolbarAlertBannerProps:Z?{color:"error",children:A}:void 0,onColumnFilterFnsChange:I,onColumnFiltersChange:e=>{E.current=null,g(e)},onGlobalFilterChange:e=>{E.current=null,O(e)},onPaginationChange:e=>{let t="function"==typeof e?e($):e;K(t),localStorage.setItem(P,JSON.stringify(t))},onSortingChange:R,onColumnVisibilityChange:e=>{let t="function"==typeof e?e(eg):e;ep(t),localStorage.setItem(eo,JSON.stringify(t))},onColumnSizingChange:e=>{let t="function"==typeof e?e(eh):e;ef(t),localStorage.setItem(el,JSON.stringify(t))},renderTopToolbarCustomActions:()=>(0,t.jsx)(s.Tooltip,{arrow:!0,title:e("Refresh Data"),children:(0,t.jsx)("span",{children:(0,t.jsx)(l.IconButton,{disabled:X,onClick:()=>{E.current=null,ee().catch(e=>{})},children:(0,t.jsx)(d.default,{})})})}),renderRowActionMenuItems:({closeMenu:e,row:t,table:a})=>[er(e,t,a)],renderCellActionMenuItems:({closeMenu:e,cell:t,row:a,table:r,internalMenuItems:n})=>[[er(e,a,r)],...n],muiLinearProgressProps:{color:"primary",variant:"determinate",value:X?50:100},rowCount:H?.totalRowCount??0,initialState:{columnVisibility:eg,columnSizing:eh,columnPinning:{right:U?["mrt-row-actions"]:[]},pagination:{pageIndex:0,pageSize:N.pageSize}},state:{columnFilters:o,columnFilterFns:p,globalFilter:D,isLoading:Y,pagination:$,columnVisibility:eg,columnSizing:eh,showAlertBanner:Z,showProgressBars:X,showSkeletons:Y,sorting:F},mrtTheme:e=>({baseBackgroundColor:ei})});return(0,t.jsx)(i.MaterialReactTable,{table:eb})}let M=new g.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,gcTime:0,retry:!1}}});function T(){let[e,r]=a.useState({vertical:"top",horizontal:"left"});return a.useEffect(()=>{let e=window.matchMedia("(max-width: 600px)"),t=e=>{e.matches?r({vertical:"top",horizontal:"left"}):r({vertical:"bottom",horizontal:"left"})};return e.matches?r({vertical:"top",horizontal:"left"}):r({vertical:"bottom",horizontal:"left"}),e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[r]),(0,t.jsx)(p.QueryClientProvider,{client:M,children:(0,t.jsx)(x.SnackbarProvider,{anchorOrigin:e,maxSnack:5,autoHideDuration:6e3,children:(0,t.jsx)(o.Card,{children:(0,t.jsx)(I,{})})})})}function D(){let{t:e}=(0,S.useTranslation)();return a.useEffect(()=>{document.title=`${e("Query Log")} | ${e("Dashboard")} | ${n.config.site.name}`},[e]),(0,t.jsx)(r.default,{spacing:2,children:(0,t.jsx)(T,{})})}e.s(["default",()=>D],78910)}]);