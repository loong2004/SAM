(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32528,e=>{"use strict";var t=e.i(54624);e.s(["createSvgIcon",()=>t.default])},3807,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(614),n=e.i(80926),i=e.i(33938),l=e.i(13607),o=e.i(69120),s=e.i(42669),c=e.i(6376),u=e.i(37563),d=e.i(78365),m=e.i(17751),g=e.i(12598),p=e.i(19273),h=e.i(66027),f=e.i(98759),S=e.i(9578);e.i(21845);var b=e.i(22831),C=e.i(73869),v=e.i(76421),y=e.i(57305),_=e.i(83388),w=e.i(36307),I=e.i(50967);function x(){let{t:e}=(0,b.useTranslation)(),r="clients-table-column-visibility",n="clients-table-column-sizing",l="clients-table-pagination",m=localStorage.getItem(r),g=localStorage.getItem(n),x=localStorage.getItem(l),M={},T={},z={pageIndex:0,pageSize:10};try{m&&(M=JSON.parse(m))}catch{localStorage.removeItem(r),M={}}try{g&&(T=JSON.parse(g))}catch{localStorage.removeItem(n),T={}}try{x&&(z=JSON.parse(x))}catch{localStorage.removeItem(l),z={pageIndex:0,pageSize:10}}let D=M||{},[P,R]=a.useState(D),[j,A]=a.useState(T),O=(0,a.useMemo)(()=>[{accessorKey:"id",header:e("ID"),size:110,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"client_ip",header:e("Client IP"),size:360,enableColumnActions:!1,columnFilterModeOptions:["contains","equals"]},{accessorKey:"mac",header:e("Mac Address"),size:240,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"hostname",header:e("Host Name"),size:250,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"last_query_timestamp",header:e("Last Query Time"),Cell:({cell:e})=>{let a=new Date(e.getValue()).toLocaleString();return(0,t.jsx)("span",{children:a})},columnFilterModeOptions:["equals"],enableColumnActions:!1,size:120}],[e]),{checkSessionError:E}=(0,S.useUser)(),[F,k]=(0,a.useState)([]),[N,q]=(0,a.useState)(()=>Object.fromEntries(O.map(({accessorKey:e})=>[e,"equals"]))),[K,L]=(0,a.useState)(!1),[B,J]=(0,a.useState)(""),[$,H]=(0,a.useState)("Error loading data"),[Q,U]=(0,a.useState)([]),G=a.useRef(0),V=a.useRef(null),[W,Z]=(0,a.useState)(z),[X,Y]=(0,a.useState)(0),ee=a.useRef(!1),[et,ea]=(0,a.useState)(C.MRT_Localization_EN),{enqueueSnackbar:er}=(0,I.useSnackbar)(),[en]=a.useState(()=>window.innerWidth>=1200);a.useEffect(()=>{let e=new URLSearchParams(location.search),t=[];for(let[a,r]of e.entries())O.some(e=>e.accessorKey===a)&&t.push({id:a,value:r});k(t),K||L(!0)},[K,O]);let{data:{data:ei=[],meta:el}={},isError:eo,isRefetching:es,isLoading:ec,refetch:eu}=(0,h.useQuery)({enabled:K,queryKey:["table-data",N,F,B,W.pageIndex,W.pageSize,Q],queryFn:async()=>{let e=W.pageIndex+1,t={page_num:e,page_size:W.pageSize};for(let a of(ee.current&&(ee.current=!1,t.total_count=X),null!==V.current&&void 0!==V.current&&(e>G.current&&e===G.current+1?V.current.lastID>=0&&(t.cursor=V.current.lastID,t.total_count=X,t.cursor_direction="next"):e<G.current&&e===G.current-1&&V.current.firstID>=0&&(t.cursor=V.current.firstID,t.total_count=X,t.cursor_direction="prev")),G.current=e,F))if(null!==a.id&&void 0!==a.id&&null!==a.value&&void 0!==a.value){if("last_query_timestamp"===a.id){let e=a.value;2===e.length&&(e[0]&&(t.timestamp_after=new Date(e[0]).getTime()),e[1]&&(t.timestamp_before=new Date(e[1]).getTime()))}t[a.id]=a.value}let a=await f.smartdnsServer.GetClients(t);if(a.error)throw await E?.(a.error),H(f.smartdnsServer.getErrorMessage(a.error)),Error($);if(null===a.data||void 0===a.data)throw H("Error loading data"),Error($);let r=0;return a.data.total_count>0&&a.data.client_list.length>0&&(V.current={firstID:a.data.client_list[0].id,lastID:a.data.client_list.at(-1).id,pageNumber:e+1},r=a.data.total_count),Y(r),{data:a.data.client_list,meta:{totalRowCount:r}}},placeholderData:p.keepPreviousData});a.useEffect(()=>{null!==y.default.language&&void 0!==y.default.language&&("zh-CN"===y.default.language?ea(v.MRT_Localization_ZH_HANS):ea(C.MRT_Localization_EN))},[]);let ed=a.useCallback(async t=>{er(e("Not implemented yet."),{style:{whiteSpace:"pre-line"}})},[e,er]),em=a.useCallback(async t=>{let a=t.original.id,r=t.original.client_ip,n=await f.smartdnsServer.DeleteClientById(a);n.error?er(`${e("Error")}: ${e(f.smartdnsServer.getErrorMessage(n.error))}, id: ${a}`,{variant:"error"}):er(e("Delete client {{id}} {{client_ip}} successfully.",{id:a,clientIP:r}),{variant:"success"})},[e,er]),eg=(e,a,r)=>[(0,t.jsx)(i.MRT_ActionMenuItem,{icon:(0,t.jsx)(w.default,{}),label:"Mac Vendor",onClick:async t=>{t.preventDefault(),e(),await ed(a)},table:r},"mac_vendor"),(0,t.jsx)(i.MRT_ActionMenuItem,{icon:(0,t.jsx)(_.default,{}),label:"Delete",onClick:async t=>{t.preventDefault(),e(),await em(a)},table:r},"delete")],{colorScheme:ep}=(0,u.useColorScheme)(),eh=a.useMemo(()=>(0,c.createTheme)({palette:{mode:"dark"===ep?"dark":"light"}}),[ep]).palette.background.paper,ef=(0,i.useMaterialReactTable)({columns:O,data:ei,localization:et,enableColumnResizing:!0,enableSorting:!1,enableColumnOrdering:!0,enableRowActions:!0,enableCellActions:!0,enableClickToCopy:window.isSecureContext,enableGlobalFilter:!1,columnFilterDisplayMode:"popover",enableColumnFilterModes:!0,enableColumnPinning:!0,enableColumnDragging:!1,enableKeyboardShortcuts:!1,manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiFilterDateTimePickerProps:{ampm:!1},muiPaginationProps:{disabled:es},muiToolbarAlertBannerProps:eo?{color:"error",children:$}:void 0,onColumnFilterFnsChange:q,onColumnFiltersChange:e=>{k(e)},onGlobalFilterChange:e=>{J(e)},onPaginationChange:e=>{let t="function"==typeof e?e(W):e;Z(t),localStorage.setItem(l,JSON.stringify(t))},onSortingChange:U,onColumnVisibilityChange:e=>{let t="function"==typeof e?e(P):e;R(t),localStorage.setItem(r,JSON.stringify(t))},onColumnSizingChange:e=>{let t="function"==typeof e?e(j):e;A(t),localStorage.setItem(n,JSON.stringify(t))},renderTopToolbarCustomActions:()=>(0,t.jsx)(s.Tooltip,{arrow:!0,title:e("Refresh Data"),children:(0,t.jsx)("span",{children:(0,t.jsx)(o.IconButton,{disabled:es,onClick:()=>{eu().catch(e=>{})},children:(0,t.jsx)(d.default,{})})})}),renderRowActionMenuItems:({closeMenu:e,row:t,table:a})=>[eg(e,t,a)],renderCellActionMenuItems:({closeMenu:e,cell:t,row:a,table:r,internalMenuItems:n})=>[[eg(e,a,r)],...n],muiLinearProgressProps:{color:"primary",variant:"determinate",value:es?50:100},rowCount:el?.totalRowCount??0,initialState:{columnVisibility:P,columnSizing:j,columnPinning:{right:en?["mrt-row-actions"]:[]}},state:{columnFilters:F,columnFilterFns:N,globalFilter:B,isLoading:ec,pagination:W,columnVisibility:P,columnSizing:j,showAlertBanner:eo,showProgressBars:es,showSkeletons:ec,sorting:Q},mrtTheme:e=>({baseBackgroundColor:eh})});return(0,t.jsx)(i.MaterialReactTable,{table:ef})}let M=new m.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,gcTime:0,retry:!1}}});function T(){let[e,r]=a.useState({vertical:"top",horizontal:"left"});return a.useEffect(()=>{let e=window.matchMedia("(max-width: 600px)"),t=e=>{e.matches?r({vertical:"top",horizontal:"left"}):r({vertical:"bottom",horizontal:"left"})};return e.matches?r({vertical:"top",horizontal:"left"}):r({vertical:"bottom",horizontal:"left"}),e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[r]),(0,t.jsx)(g.QueryClientProvider,{client:M,children:(0,t.jsx)(I.SnackbarProvider,{anchorOrigin:e,maxSnack:5,autoHideDuration:6e3,children:(0,t.jsx)(l.Card,{children:(0,t.jsx)(x,{})})})})}function z(){let{t:e}=(0,b.useTranslation)();return a.useEffect(()=>{document.title=`${e("Clients")} | ${e("Dashboard")} | ${n.config.site.name}`},[e]),(0,t.jsx)(r.default,{spacing:2,children:(0,t.jsx)(T,{})})}e.s(["default",()=>z],3807)}]);